geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
View(age_split_who)
age_split_who <- age_split_who %>%
unite(col = 'age_range', min_age:max_age, sep='_')
View(age_split_who)
head(age_split_who)
count_diagnosis_all <- age_split_who %>%
group_by(diagnosis) %>%
summarise(count)
View(count_diagnosis_all)
count_diagnosis_all <- age_split_who %>%
group_by(diagnosis) %>%
summarise(sum(count))
View(count_diagnosis_all)
count_diagnosis_all <- age_split_who %>%
group_by(diagnosis) %>%
drop_na() %>%
summarise(sum(count))
View(count_diagnosis_all)
count_diagnosis_age <- age_split_who %>%
group_by(diagnosis, age_range) %>%
drop_na() %>%
summarise(sum(count))
View(count_diagnosis_age)
count_diagnosis_combined <- count_diagnosis_all %>%
inner_join(count_diagnosis_age, by='diagnosis')
View(count_diagnosis_combined)
count_diagnosis_all <- age_split_who %>%
group_by(diagnosis) %>%
drop_na() %>%
summarise(total_sum=sum(count))
View(count_diagnosis_all)
count_diagnosis_age <- age_split_who %>%
group_by(diagnosis, age_range) %>%
drop_na() %>%
summarise(sum_by_age=sum(count))
View(count_diagnosis_age)
count_diagnosis_combined <- count_diagnosis_all %>%
inner_join(count_diagnosis_age, by='diagnosis')
View(count_diagnosis_combined)
count_diagnosis_combined <- count_diagnosis_all %>%
inner_join(count_diagnosis_age, by='diagnosis') %>%
mutate(perc_diag_by_age = scales::percent(sum_by_age/total_sum))
View(count_diagnosis_combined)
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col()+
facet_grid(~ age_range
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col()+
facet_grid(. ~ age_range)
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(color=diagnosis)+
facet_grid(. ~ age_range)
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(color=diagnosis))+
facet_grid(. ~ age_range)
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group') +
scale_y_continuous(breaks=c(.15,.45,.75,1))
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(age_range ~ .)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range, scales='free')+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
count_diagnosis_combined %>%
mutate(hits=factor(percent_by_age,levels = c("<1",0:100),ordered = T)) %>%
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range, scales='free')+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
count_diagnosis_combined %>%
mutate(hits=factor(perc_diag_by_age,levels = c("<1",0:100),ordered = T)) %>%
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range, scales='free')+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
count_diagnosis_combined %>%
mutate(perc_diag_by_age=factor(perc_diag_by_age,levels = c("<1",0:100),ordered = T)) %>%
ggplot(count_diagnosis_combined, aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range, scales='free')+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
count_diagnosis_combined %>%
mutate(perc_diag_by_age=factor(perc_diag_by_age,levels = c("<1",0:100),ordered = T)) %>%
ggplot(aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range, scales='free')+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
count_diagnosis_combined %>%
mutate(perc_diag_by_age=factor(perc_diag_by_age,levels = c("<1",0:100),ordered = T)) %>%
ggplot(aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
View(count_diagnosis_combined)
count_diagnosis_combined %>%
mutate(perc_diag_by_age=factor(perc_diag_by_age,levels = c("<1",0:100),ordered = T))
count_diagnosis_combined %>%
mutate(perc_diag_by_age=factor(perc_diag_by_age,levels = c("1.965",0:100),ordered = T)) %>%
ggplot(aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
count_diagnosis_combined <- count_diagnosis_all %>%
inner_join(count_diagnosis_age, by='diagnosis') %>%
mutate(perc_diag_by_age = (sum_by_age/total_sum))
ggplot(count_diagnosis_combined,aes(x=diagnosis, y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
ggplot(count_diagnosis_combined,aes(x=diagnosis,
y=scales::percent(perc_diag_by_age)))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
ggplot(count_diagnosis_combined,aes(x=diagnosis,
y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
scale_y_continuous(labels = scales::percent())
ggplot(sales) +
geom_point(aes(x=Sales,y=Profit,color=Discount)) +
geom_smooth(method='lm',aes(y=Profit,x=Sales)) +
facet_grid(.~Category) +
scale_y_continuous(labels=scales::dollar_format()) +
theme(axis.text.x = element_text(angle = 45)) +
labs(title='Sales to Profit')
ggplot(count_diagnosis_combined,aes(x=diagnosis,
y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
scale_y_continuous(labels = scales::percent_format())
?scales::percent_format
ggplot(count_diagnosis_combined,aes(x=diagnosis,
y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')
scale_y_continuous(labels = scales::percent_format(scale=100, suffix="%"))
ggplot(count_diagnosis_combined,aes(x=diagnosis,
y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')+
scale_y_continuous(labels = scales::percent_format(scale=100, suffix="%"))
View(age_split_who_year)
View(age_split_who)
View(population)
max_pop_year <- age_split_who %>%
group_by(year,gender,diagnosis) %>%
drop_na() %>%
summarize(max(population))
View(max_pop_year)
min_pop_year <-age_split_who %>%
group_by(year,gender,diagnosis) %>%
drop_na() %>%
summarize(min(population))
View(min_pop_year)
max_pop_year <- age_split_who %>%
group_by(year,gender,diagnosis) %>%
drop_na() %>%
summarize(max_pop=max(population))
min_pop_year <-age_split_who %>%
group_by(year,gender,diagnosis) %>%
drop_na() %>%
summarize(min_pop=min(population))
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('year','gender','diagnosis')) %>%
group_by(year,gender,diagnosis) %>%
summarize(min_pop/max_pop)
View(age_split_who_popgroup)
max_pop_year <- age_split_who %>%
group_by(country,year,gender,diagnosis) %>%
drop_na() %>%
summarize(max_pop=max(population))
View(max_pop_year)
min_pop_year <-age_split_who %>%
group_by(country,year,gender,diagnosis) %>%
drop_na() %>%
summarize(min_pop=min(population))
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('year','gender','diagnosis')) %>%
group_by(year,gender,diagnosis) %>%
summarize(min_pop/max_pop)
View(age_split_who_popgroup)
gplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=gender))+
geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=gender))+
geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('year','gender','diagnosis')) %>%
group_by(year,gender,diagnosis) %>%
summarize(population_percentage=min_pop/max_pop)
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=gender))+
geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('country','year','gender','diagnosis')) %>%
group_by(year,gender,diagnosis) %>%
summarize(population_percentage=min_pop/max_pop)
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=gender))+
geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=gender))+
#geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
View(age_split_who_popgroup)
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('country','year','gender','diagnosis')) %>%
group_by(year,gender,diagnosis) %>%
reframe(population_percentage=min_pop/max_pop)
View(age_split_who_popgroup)
View(min_pop_year)
View(max_pop_year)
max_pop_year <- age_split_who %>%
group_by(country,year) %>%
drop_na() %>%
summarize(max_pop=max(population))
min_pop_year <-age_split_who %>%
group_by(country,year) %>%
drop_na() %>%
summarize(min_pop=min(population))
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('country','year')) %>%
group_by(year,gender,diagnosis) %>%
reframe(population_percentage=min_pop/max_pop)
View(age_split_who_popgroup)
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('country','year')) %>%
group_by(year,gender,diagnosis) %>%
reframe(population_percentage=min_pop/max_pop)
max_pop_year <- age_split_who %>%
group_by(country,year, gender, diagnosis) %>%
drop_na() %>%
summarize(max_pop=max(population))
min_pop_year <-age_split_who %>%
group_by(country,year,gender, diagnosis) %>%
drop_na() %>%
summarize(min_pop=min(population))
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('country','year')) %>%
group_by(year,gender,diagnosis) %>%
reframe(population_percentage=min_pop/max_pop)
View(age_split_who_popgroup)
View(age_split_who_popgroup)
View(min_pop_year)
View(max_pop_year)
?max
max_pop_year <- age_split_who %>%
group_by(country, year, gender, diagnosis) %>%
drop_na() %>%
summarize(max_pop=max(population, na.rm = TRUE))
View(max_pop_year)
max_pop_year <- age_split_who %>%
group_by(country, year, gender, diagnosis) %>%
drop_na() %>%
summarize(max_pop=pmax(population, na.rm = TRUE))
View(max_pop_year)
View(min_pop_year)
max_pop_year <- age_split_who %>%
group_by(country, year, gender, diagnosis) %>%
drop_na() %>%
reframe(max_pop=pmax(population, na.rm = TRUE))
View(max_pop_year)
max_pop_year <- age_split_who %>%
group_by(year, gender, diagnosis) %>%
drop_na() %>%
reframe(max_pop=pmax(population, na.rm = TRUE))
View(max_pop_year)
max_pop_year <- age_split_who %>%
group_by(year, gender, diagnosis) %>%
drop_na() %>%
reframe(max_pop=max(population, na.rm = TRUE))
View(max_pop_year)
in_pop_year <-age_split_who %>%
group_by(year,gender, diagnosis) %>%
drop_na() %>%
reframe(min_pop=min(population, na.rm = TRUE))
min_pop_year <-age_split_who %>%
group_by(year,gender, diagnosis) %>%
drop_na() %>%
reframe(min_pop=min(population, na.rm = TRUE))
View(min_pop_year)
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('country','year')) %>%
group_by(year,gender,diagnosis) %>%
reframe(population_percentage=min_pop/max_pop)
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('year', 'gender', 'diagnosis')) %>%
group_by(year,gender,diagnosis) %>%
reframe(population_percentage=min_pop/max_pop)
View(age_split_who_popgroup)
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=gender))+
#geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=gender))+
geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=1))+
geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=1))+
geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=solid, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=1))+
geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=gender))+
geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
ggplot(count_diagnosis_combined,aes(x=diagnosis,
y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')+
scale_y_continuous(labels = scales::percent_format(scale=100, suffix="%"))
library(dplyr)
library(tidyr)
library(ggplot2)
data(who)
force(who)
data("population")
force(population)
#Pivot Long to match format above
who_long_data <- who %>%
pivot_longer(cols = !country:year,
names_to = c("diagnosis", "gender", "age"),
names_pattern = ("new_?(.*)_(.)(.*)"),
values_to = "count")
head(who_long_data)
#Left join as to not lose any data in who dataset
left_join_who <- who_long_data %>%
left_join(population, by=c('country', 'year'))
head(left_join_who)
?separate()
# Use sep=-2 to account for uneven character split
age_split_who <- left_join_who %>%
separate(age, c("min_age", "max_age")
,sep = -2
)
head(age_split_who)
# your code here
age_split_who  <- age_split_who %>%
mutate(min_age = ifelse(min_age=="", 0, min_age)) %>%
mutate(max_age = ifelse(max_age== 65, "Inf", max_age))
head(age_split_who)
gender_count <- age_split_who %>%
group_by(gender) %>%
summarize(count_per_diagnosis=sum(count, na.rm = TRUE))
gender_count
gender_count <- age_split_who %>%
group_by(gender, diagnosis) %>%
summarize(count_per_diagnosis=sum(count, na.rm = TRUE))
gender_count
ggplotgender_count) +
ggplot(gender_count) +
geom_col(aes(x=gender, y=count)) +
facet_grid(.~diagnosis) +
scale_y_continuous(labels =scales::number_format(scale=1)) +
labs(x="Gender",
y="Count of Diagnosis",
title = "Count of TB Cases by Diagnosis and Gender")
ggplot(gender_count) +
geom_col(aes(x=gender, y=count_per_diagnosis)) +
facet_grid(.~diagnosis) +
scale_y_continuous(labels =scales::number_format(scale=1)) +
labs(x="Gender",
y="Count of Diagnosis",
title = "Count of TB Cases by Diagnosis and Gender")
ggplot(gender_count) +
geom_col(aes(x=gender, y=count_per_diagnosis)) +
facet_grid(.~diagnosis) +
scale_y_continuous(labels =scales::number_format(scale=.000001, suffix="m")) +
labs(x="Gender",
y="Count of Diagnosis in Millions",
title = "Count of TB Cases by Diagnosis and Gender")
# Find max population in dataset
max_pop_year <- age_split_who %>%
group_by(year, gender, diagnosis) %>%
#drop_na() to remove na rows
drop_na() %>%
#reframe instead of summarize to resolve errors (more than one result row
#per result in join)
reframe(max_pop=max(population, na.rm = TRUE))
# Find min population in dataset
min_pop_year <-age_split_who %>%
group_by(year,gender, diagnosis) %>%
drop_na() %>%
reframe(min_pop=min(population, na.rm = TRUE))
#join min and max together, and divide min over max to get percentage
age_split_who_popgroup <- max_pop_year %>%
inner_join(min_pop_year, by=c('year', 'gender', 'diagnosis')) %>%
group_by(year,gender,diagnosis) %>%
reframe(population_percentage=min_pop/max_pop)
# your code here
ggplot(age_split_who_popgroup, aes(x=year, y=population_percentage, group=gender))+
geom_jitter(aes(color=gender), width=.5)+
geom_line(aes(linetype=gender, color=gender))+
geom_point(aes(shape=gender, color=gender))+
facet_grid(rows=vars(diagnosis))
View(gender_count)
# your code here
age_split_who <- age_split_who %>%
unite(col = 'age_range', min_age:max_age, sep='_')
head(age_split_who)
#1) Find count of all diagnoses
count_diagnosis_all <- age_split_who %>%
group_by(diagnosis) %>%
drop_na() %>%
summarise(total_sum=sum(count))
#2) Count of all diagnoses by age group
count_diagnosis_age <- age_split_who %>%
group_by(diagnosis, age_range) %>%
drop_na() %>%
summarise(sum_by_age=sum(count))
View(count_diagnosis_age)
View(count_diagnosis_all)
#3) Join 1) to 2). Use inner join to find
count_diagnosis_combined <- count_diagnosis_all %>%
inner_join(count_diagnosis_age, by='diagnosis') %>%
mutate(perc_diag_by_age = (sum_by_age/total_sum))
#4) Plot data as a geom_col where the x axis is the diagnosis, y axis is the percent of total, and faceted by age group
ggplot(count_diagnosis_combined,aes(x=diagnosis,
y=perc_diag_by_age))+
geom_col(aes(fill=diagnosis))+
facet_grid(. ~ age_range)+
labs(x='Diagnoses',
y='Percent By Age',
title='Percent of Total Diagnoses by Age Group')+
scale_y_continuous(labels = scales::percent_format(scale=100, suffix="%"))
View(count_diagnosis_combined)
